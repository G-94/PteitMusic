cmake_minimum_required(VERSION 3.16)
project(PteitMusic VERSION 0.1 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)
set(CMAKE_AUTOUIC ON)

# ========== –ù–ê–°–¢–†–û–ô–ö–ê –í–´–•–û–î–ù–û–ô –ü–ê–ü–ö–ò ==========
# –í–°–ï —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –≤ –ø–∞–ø–∫–µ bin –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin)

# ========== –ü–û–ò–°–ö QT ==========
find_package(Qt6 REQUIRED COMPONENTS
    Core
    Widgets
    Multimedia
    MultimediaWidgets
    Network
    Concurrent
)

# ========== –ü–û–õ–£–ß–ê–ï–ú –ü–£–¢–ò –ö QT ==========
get_target_property(QT_CORE_LOCATION Qt6::Core LOCATION)
get_filename_component(QT_BIN_DIR ${QT_CORE_LOCATION} DIRECTORY)
get_filename_component(QT_ROOT_DIR ${QT_BIN_DIR} DIRECTORY)

message(STATUS "Qt binaries: ${QT_BIN_DIR}")

# ========== –°–û–ó–î–ê–ù–ò–ï –ò–°–ü–û–õ–ù–Ø–ï–ú–û–ì–û –§–ê–ô–õ–ê ==========
qt_add_executable(appPteitMusic
    main.cpp
    musicapi.cpp musicapi.h
    homepage.h homepage.cpp
    searchpanelwidget.h searchpanelwidget.cpp
    playerwidget.h playerwidget.cpp
    songtracklistitem.h songtracklistitem.cpp
    scrollabletracklist.h scrollabletracklist.cpp
    likespagewidget.h likespagewidget.cpp
    downloadpagewidget.h downloadpagewidget.cpp
    MusicGlobals.h
    playlistshubpagewidget.h playlistshubpagewidget.cpp
    genrelistwidget.h genrelistwidget.cpp
    artistslistwidget.h artistslistwidget.cpp
    artistslistitem.h artistslistitem.cpp
    styles.h styles.cpp


)

target_include_directories(appPteitMusic PRIVATE ${CMAKE_CURRENT_SOURCE_DIR})

target_link_libraries(appPteitMusic
    PRIVATE
        Qt6::Core
        Qt6::Widgets
        Qt6::Multimedia
        Qt6::MultimediaWidgets
        Qt6::Network
        Qt6::Concurrent
)

# ========== Windows –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ==========
if(WIN32)
    target_link_libraries(appPteitMusic PRIVATE ws2_32 user32 gdi32 winmm advapi32)
endif()

set_target_properties(appPteitMusic PROPERTIES
    OUTPUT_NAME "PteitMusic"
    WIN32_EXECUTABLE TRUE
)

# ========== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –í–°–ï–• –ù–£–ñ–ù–´–• DLL ==========
if(WIN32)
    # –°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–ø–∫–∏
    file(MAKE_DIRECTORY "${CMAKE_SOURCE_DIR}/bin")
    file(MAKE_DIRECTORY "${CMAKE_SOURCE_DIR}/bin/platforms")
    file(MAKE_DIRECTORY "${CMAKE_SOURCE_DIR}/bin/Data")

    # 1. –ö–û–ü–ò–†–£–ï–ú –í–°–ï –û–°–ù–û–í–ù–´–ï QT DLL
    set(QT_DLLS
        Qt6Core.dll
        Qt6Gui.dll
        Qt6Widgets.dll
        Qt6Multimedia.dll
        Qt6MultimediaWidgets.dll
        Qt6Network.dll
        Qt6Concurrent.dll
    )

    foreach(DLL ${QT_DLLS})
        set(SOURCE_DLL "${QT_BIN_DIR}/${DLL}")
        if(EXISTS ${SOURCE_DLL})
            add_custom_command(TARGET appPteitMusic POST_BUILD
                COMMAND ${CMAKE_COMMAND} -E copy_if_different
                    "${SOURCE_DLL}"
                    "${CMAKE_SOURCE_DIR}/bin/"
                COMMENT "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ${DLL}..."
            )
        endif()
    endforeach()

    # 2. –ö–û–ü–ò–†–£–ï–ú MINGW DLL (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
    set(MINGW_DLLS
        libgcc_s_seh-1.dll
        libstdc++-6.dll
        libwinpthread-1.dll
    )

    foreach(DLL ${MINGW_DLLS})
        set(SOURCE_DLL "${QT_BIN_DIR}/${DLL}")
        if(EXISTS ${SOURCE_DLL})
            add_custom_command(TARGET appPteitMusic POST_BUILD
                COMMAND ${CMAKE_COMMAND} -E copy_if_different
                    "${SOURCE_DLL}"
                    "${CMAKE_SOURCE_DIR}/bin/"
                COMMENT "–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ ${DLL}..."
            )
        endif()
    endforeach()

    # 3. –ö–û–ü–ò–†–£–ï–ú –ü–õ–ê–¢–§–û–†–ú–ï–ù–ù–´–ô –ü–õ–ê–ì–ò–ù (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
    set(PLATFORM_PLUGIN "${QT_ROOT_DIR}/plugins/platforms/qwindows.dll")
    if(NOT EXISTS ${PLATFORM_PLUGIN})
        set(PLATFORM_PLUGIN "${QT_BIN_DIR}/plugins/platforms/qwindows.dll")
    endif()

    if(EXISTS ${PLATFORM_PLUGIN})
        add_custom_command(TARGET appPteitMusic POST_BUILD
            COMMAND ${CMAKE_COMMAND} -E copy_if_different
                "${PLATFORM_PLUGIN}"
                "${CMAKE_SOURCE_DIR}/bin/platforms/qwindows.dll"
            COMMENT "‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ qwindows.dll (–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –ø–ª–∞–≥–∏–Ω)"
        )
    else()
        message(WARNING "‚ö†Ô∏è qwindows.dll –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è.")
    endif()

    # 4. –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê
    add_custom_command(TARGET appPteitMusic POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E echo ""
        COMMAND ${CMAKE_COMMAND} -E echo "========================================="
        COMMAND ${CMAKE_COMMAND} -E echo "‚úÖ –°–ë–û–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
        COMMAND ${CMAKE_COMMAND} -E echo "üìÅ –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª: ${CMAKE_SOURCE_DIR}/bin/PteitMusic.exe"
        COMMAND ${CMAKE_COMMAND} -E echo "üìÅ –ü–∞–ø–∫–∞ platforms: ${CMAKE_SOURCE_DIR}/bin/platforms/"
        COMMAND ${CMAKE_COMMAND} -E echo "========================================="
    )
endif()
